var SABAI=SABAI||{};!function(a){if(SABAI.console=window.console||{log:function(a){alert(a)}},SABAI.isRTL=!1,SABAI.init=function(){var b=function(b){SABAI.fadeout(a(".sabai-fadeout",b))},c=function(b){a("input.sabai-form-check-trigger",b).show().click(function(){var b=a(this);b.closest("table").find("input.sabai-form-check-target, input.sabai-form-check-trigger").not(":disabled").prop("checked",b.prop("checked"))})},d=function(b){a("fieldset.sabai-form-collapsible",b).not(".sabai-form-collapsible-processed").each(function(){var b=a(this);b.find("> legend span:first").prepend('<i class="fa fa-caret-down"></i> ').wrap('<a class="sabai-form-collapsible" href="#"></a>').end().find("a.sabai-form-collapsible:first").click(function(){return a(this).toggleClass("sabai-form-collapsed").find("i").toggleClass("fa-caret-down").toggleClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right").end().closest(".sabai-form-collapsible-processed").toggleClass("sabai-form-collapsed").find(".sabai-form-fields:first").slideToggle("fast",function(){a(this).find("textarea:visible").autosize()}),!1}).end().addClass("sabai-form-collapsible-processed"),b.hasClass("sabai-form-collapsed")&&(b.hasClass("sabai-form-field-error")?b.removeClass("sabai-form-collapsed"):b.find(".sabai-form-fields:first").css({display:"none"}).end().find("a.sabai-form-collapsible:first").addClass("sabai-form-collapsed").find("i").removeClass("fa-caret-down").addClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right"))})},e=function(b){a("textarea:visible",b).autosize()},f=function(b){"ontouchstart"in document.documentElement||a('[rel="sabaitooltip"]',b).each(function(){var c=a(this),d="sabai-content"===b.attr("id")&&c.closest("#sabai-inline-content").length?c.closest("#sabai-inline-content"):c.data("container")||b;c.sabaitooltip({container:d})}),a("a[data-popover-url]",b).bind("click",function(c){var d=a(this).unbind("hover"),e={html:!0,container:"sabai-content"===b.attr("id")&&d.closest("#sabai-inline-content").length?d.closest("#sabai-inline-content"):d.data("container")||b,url:d.data("popover-url")};SABAI.isRTL?e.placement=function(b,c){return a(c).offset().left>300?"left":"auto"}:e.placement=function(b,c){var d=a(c);return window.innerWidth-(d.offset().left+d.innerWidth())>300?"right":"auto"},SABAI.popover(d,e),c.preventDefault()})},g=function(b){a("a.sabai-toggle",b).not(".sabai-toggle-processed").unbind("click").click(function(b){var c=a(this).addClass("sabai-toggle-processed"),d=a(c.data("toggle-target"));if(a.trim(d.html())){a(SABAI).trigger("toggle.sabai",{trigger:c,target:d});var e=c.data("toggle-cookie"),f=c.hasClass("sabai-toggle-slide")?"slideToggle":"toggle";d[f]("fast",function(){var b=d.is(":visible");c.toggleClass("sabai-active",b),e&&a.cookie(e,b?1:0,{path:SABAI.path,domain:SABAI.domain}),a(SABAI).trigger("toggled.sabai",{trigger:c,target:d})}),b.preventDefault()}})},h=function(b){a(".sabai-carousel",b).each(function(){var b=a(this);b.data("carousel",b.bxSlider(b.data("carousel-options")||{})),a(SABAI).bind("entity_filter_form_toggled.sabai",function(a,c){b.parents(c.container).length&&b.data("carousel").redrawSlider()})})},i=function(b){a("a.sabai-form-field-add",b).each(function(){var b=a(this),c=b.closest(".sabai-form-fields"),d=parseInt(b.data("field-max-num"));b.click(function(a){var e=b.data("field-next-index");SABAI.cloneField(c,b.data("field-name"),d,e,b),e&&b.data("field-next-index",++e),a.preventDefault()}),c.find("> .sabai-form-field:not(.sabai-form-field-add)").each(function(e){0!==e&&a(this).append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').find("a.sabai-form-field-remove").click(function(e){a(this).closest(".sabai-form-field").fadeTo("fast",0,function(){a(this).slideUp("fast",function(){a(this).remove(),d&&c.find("> .sabai-form-field:not(.sabai-form-field-add)").length<d&&b.show()})}),e.preventDefault()}).parent().css("position","relative")}),d&&c.find("> .sabai-form-field:not(.sabai-form-field-add)").length>=d&&b.hide()})};return function(j,k){b(j),c(j),d(j),e(j),f(j),g(j),h(j),i(j),"function"==typeof prettyPrint&&prettyPrint(),"function"==typeof a.fn.prettyPhoto&&a('a[rel^="prettyPhoto"]',j).prettyPhoto(),a(".sabai-dropdown-toggle",j).sabaidropdown(),a(".sabai-click",j).click(),k&&k.call(null,j),a(SABAI).trigger("sabai_init.sabai",{context:j})}}(),SABAI.fadeout=function(b,c){c=c||6e3,a(b).animate({opacity:"+=0"},c,function(){a(this).fadeOut("fast",function(){a(this).remove()})})},SABAI.cache=function(){var a={};return function(b,c,d){if(1==arguments.length)return!!a[b]&&(!(a[b].expires<(new Date).getTime())&&a[b].data);d=d||600,a[b]={data:c,expires:(new Date).getTime()+1e3*d}}}(),SABAI.flash=function(b,c){if(void 0!==b&&null!==b)if("string"==typeof b)a.growl(b,{type:c,delay:"danger"===c?0:5e3,z_index:999999});else for(var d=0;d<b.length;d++)SABAI.flash(b[d].msg,b[d].level)},SABAI.load=function(b,c,d){var e=a(b);return e.load(c,{__ajax:b},function(a,b,c){SABAI.init(e),d&&d.call(e,a,b,c)}),e},SABAI.replace=function(b,c,d,e){var f;return a.get(c,{__ajax:b},function(c,g,h){e?f=a(b).html(c):(a(b).replaceWith(c),f=a(b)),SABAI.init(f),d&&d.call(null,f,c,g,h)}),f},SABAI.popover=function(b,c,d){if(b=b instanceof jQuery?b:a(b),d||!b.hasClass("sabai-popover-processed")){if(c=c||{},c.template='<div class="sabai-popover"><div class="sabai-arrow"></div><div class="sabai-popover-inner"><div class="sabai-close"><i class="fa fa-times"></i></div><div class="sabai-popover-title"></div><div class="sabai-popover-content"></div></div></div>',c.url){var e=SABAI.cache(c.url);e?c.content=e:(c.content="&nbsp;",a.get(c.url,{__ajax:1},function(a){SABAI.cache(c.url,a),b.attr("data-content",a).data("bs.sabaipopover").tip().find(".sabai-popover-content").html(a),b.sabaipopover("show")}))}b.sabaipopover(c).sabaipopover("show").addClass("sabai-popover-processed").data("bs.sabaipopover").tip().css(c.width?{width:c.width}:{}).find(".sabai-close").on("click",function(){b.data("bs.sabaipopover").hide()}),SABAI.popoverInit||(a("body").on("click",function(b){a(".sabai-popover-processed").each(function(){a(this).is(b.target)||0!==a(this).has(b.target).length||0!==a(".sabai-popover").has(b.target).length||a(this).sabaipopover("hide")})}),SABAI.popoverInit=!0)}},SABAI.modal=function(){var b,c=function(){var b=a('<div class="sabai" id="sabai-modal" style="display:none;"><div class="sabai-modal-container"><div class="sabai-modal-title"><span></span><span class="sabai-close"><i class="fa fa-times"></i></span></div><div class="sabai-modal-content"></div><div class="sabai-modal-footer"></div></div></div>').prependTo("body").find(".sabai-close").mousedown(function(){a("#sabai-modal").fadeOut("fast",function(){a(this).remove()})}).end();return a(document).keyup(function(b){27==b.keyCode&&a("#sabai-modal").find(".sabai-close").mousedown()}),b},d=function(a,b){var c,d,e=document.documentElement.clientWidth<=768?.95:.8;(null===b||b>document.documentElement.clientWidth*e)&&(b=document.documentElement.clientWidth*e),a.find(".sabai-modal-container").css({width:b+"px",left:SABAI.isRTL?"auto":document.documentElement.clientWidth/2-b/2,right:SABAI.isRTL?document.documentElement.clientWidth/2-b/2:"auto",top:.07*document.documentElement.clientHeight}),d=a.find(".sabai-form-buttons").length?a.find(".sabai-form-buttons").outerHeight()+10:20,a.find(".sabai-modal-footer").css("height",d+"px"),c=.8*document.documentElement.clientHeight-a.find(".sabai-modal-title").outerHeight()-d,a.find(".sabai-modal-content").css("max-height",c+"px"),a.get(0).scrollHeight>document.documentElement.clientHeight&&a.find(".sabai-modal-content").css("height",c+"px")};return function(e,f,g,h){return b=h||(a("body").has("#sabai-modal").length?a("#sabai-modal"):c()),(f||e)&&(f&&b.find(".sabai-modal-title > span:first").text(f),e&&b.find(".sabai-modal-content").html(e),b.show()),void 0!==g&&(0===g&&(g=b.find(".sabai-modal-container").width()),d(b,g)),b}}(),SABAI.ajaxLoader=function(b,c,d){var e=a(b);if(d){var f=a(d);if(!f.length)return;if(c)f.next(".sabai-ajax-loader").remove();else{var g=a('<div class="sabai-ajax-loader"></div>').css("top",parseInt(f.position().top,10)+parseInt(f.css("margin-top"),10)+"px").width(f.outerWidth()).height(f.outerHeight());f.after(g)}e.length&&e.blur().prop("disabled",!c).css("pointer-events",c?"auto":"none")}else{if(!e.length)return;e.blur().prop("disabled",!c).css("pointer-events",c?"auto":"none").toggleClass("sabai-ajax-loading",!c)}},SABAI.ajax=function(b){var d,f,g,c=a.extend({trigger:null,async:!0,type:"get",url:"",data:"",processData:!0,target:"",container:null,modalWidth:null,cache:!1,cacheLifetime:600,onSendData:null,onSuccess:null,onError:null,onErrorFlash:!0,onContent:null,onSuccessFlash:!1,onReadyState:null,effect:null,scroll:!1,replace:!1,highlight:!1,callback:!1,loadingImage:!0,position:!1,toggle:!1,pushState:!1,state:{}},b),e="",h=0,i=function(b,d){try{var e=JSON.parse(b.replace(/<!--[\s\S]*?-->/g,""));if(c.onSuccess&&!c.onSuccess(e,d,c.trigger))return void(c.onSuccessFlash&&e.messages&&SABAI.flash(e.messages,"success"));if(e.url)return"#sabai-modal"===c.container&&a("#sabai-modal").hide(),void(window.location=e.url);c.onSuccessFlash&&e.messages&&SABAI.flash(e.messages,"success")}catch(a){SABAI.console.log("Failed parsing response:<p>"+b.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+a.toString()+"</p>")}},j=function(b,d){if("#sabai-modal"===c.container){if(c.trigger){var f=c.trigger.attr("data-modal-title");void 0!==f&&!1!==f||(f=c.trigger.attr("title")||c.trigger.attr("data-original-title")||""),SABAI.modal(b,f,c.modalWidth,d)}else SABAI.modal(b,"",c.modalWidth,d);c.onContent||(c.onContent=function(a,b,c){b.focusFirstInput()}),c.onContent(b,d,c.trigger)}else{if(c.trigger&&c.trigger.hasClass("sabai-toggle")&&a(SABAI).trigger("toggle.sabai",{trigger:c.trigger,target:d}),c.replace)c.scroll&&e&&SABAI.scrollTo(e),d=d.hide().after(b).remove().next(),c.onContent&&c.onContent(b,d,c.trigger);else{switch(c.callback||"sabai-content"==d.attr("id")||"sabai-inline-content"==d.attr("id")||d.addClass("sabai-ajax"),c.effect){case"slide":d.hide().html(b).slideDown("fast",function(){c.onContent&&c.onContent(b,d,c.trigger)});break;default:d.html(b).show(),c.onContent&&c.onContent(b,d,c.trigger)}c.scroll&&e&&SABAI.scrollTo(e)}if(c.highlight&&d.effect("highlight",{},1500),c.trigger&&c.trigger.hasClass("sabai-toggle")){var g=d.is(":visible");c.trigger.removeAttr("onclick").removeClass("sabai-click").toggleClass("sabai-active",g);var h=c.trigger.data("toggle-cookie");h&&a.cookie(h,g?1:0,{path:SABAI.path,domain:SABAI.domain}),a(SABAI).trigger("toggled.sabai",{trigger:c.trigger,target:d})}}if(c.pushState&&window.history&&window.history.pushState){var i=SABAI.parseUrl(c.url);i.pathname!==location.pathname&&(i.pathname=location.pathname),c.state.data=c.data,c.state.url=c.url,c.state.container=c.container,c.state.target=c.target,window.history.pushState(c.state,null,i.toString())}SABAI.init(d),a(SABAI).trigger("loaded.sabai",{target:d,selector:e})},k=function(a,b){try{var d=JSON.parse(a.replace(/<!--[\s\S]*?-->/g,""));if(c.onError){if(!c.onError(d,b,c.trigger))return void(c.onErrorFlash&&d.messages&&SABAI.flash(d.messages,"danger"))}else if(d.url)return void(window.location=d.url);c.onErrorFlash&&d.messages&&(c.trigger?(SABAI.popover(c.trigger,{content:d.messages[0],html:!0,container:c.trigger.closest(".sabai"),title:c.trigger.attr("data-sabaipopover-title")||""}),c.trigger.attr("onclick","return false;")):SABAI.flash(d.messages,"danger"))}catch(b){SABAI.console.log("Failed parsing response:<p>"+a.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+b.toString()+"</p>")}};if(c.trigger){if(c.trigger.hasClass("sabai-disabled"))return;c.trigger.data("cookie-name")&&c.trigger.data("cookie-value")&&a.cookie(c.trigger.data("cookie-name"),c.trigger.data("cookie-value"),{path:SABAI.path,domain:SABAI.domain}),c.url||(c.url=c.trigger.data("sabai-remote-url")),c.trigger.hasClass("sabai-dropdown-link")&&(c.trigger=c.trigger.closest(".sabai-btn-group").find(".sabai-dropdown-toggle"))}if(c.url){if(c.container)if(e=c.container,"#sabai-modal"===c.container)d=SABAI.modal();else if(c.target?(d=a(c.container).find(c.target),e=c.container+" "+c.target):d=a(c.container),!d.length)return void SABAI.console.log(e);if(c.cache&&"get"===c.type){var l=SABAI.cache(c.container+c.url);if(l)return void j(l,d)}c.onSendData&&("object"!=typeof c.data&&(c.data={}),c.onSendData(c.data,c.trigger)),"object"==typeof c.data?(c.data.hasOwnProperty("__ajax")||(c.data.__ajax=e||1),c.data=a.param(c.data)):"string"==typeof c.data&&""!==c.data?c.data+="&__ajax="+(e?encodeURIComponent(e):1):c.data="__ajax="+(e?encodeURIComponent(e):1),a.ajaxreadystate({global:!0,async:c.async,type:c.type,dataType:"html",url:c.url,data:c.data,processData:c.processData,cache:!1,beforeSend:function(a){c.loadingImage&&(d&&"sabai-content"!==d.attr("id")&&d.is(":visible")?(f="sabai-modal"===d.attr("id")?d.find(".sabai-modal-content"):d,SABAI.ajaxLoader(c.trigger,!1,f)):SABAI.ajaxLoader(c.trigger))},complete:function(a,b){switch(c.loadingImage&&SABAI.ajaxLoader(c.trigger,!0,c.replace?e:f),b){case"success":if(void 0!==g){c.loadingImage&&SABAI.ajaxLoader(c.trigger,!0);break}278==a.status||a.getResponseHeader("content-type").indexOf("json")>-1?i(a.responseText,d):(j(a.responseText,d),"get"==c.type&&c.cache&&SABAI.cache(c.container+c.url,a.responseText,c.cacheLifetime));break;case"error":k(a.responseText,d)}},readystate:function(a,b){if(c.onReadyState&&b>2&&b<4&&-1!==a.getResponseHeader("Content-Type").indexOf("application/json")){++h;var e=void 0!==g?a.responseText.substring(g.length):a.responseText;try{var f=JSON.parse(e.replace(/<!--[\s\S]*?-->/g,""));c.onReadyState(f,d,c.trigger,h)}catch(a){SABAI.console.log(a.toString())}g=a.responseText}}})}},SABAI.scrollTo=function(b,c,d){b=b instanceof jQuery?b:a(b),c=void 0!==c&&null!==c?c:1e3,d=void 0!==d&&null!==d?d:0,a.sabaiScrollTo(b,c,{offset:{top:d}})},SABAI.states=function(b,c,d){var l,m,n,o,e={},f={enabled:"disabled",optional:"required",visible:"invisible",unchecked:"checked",expanded:"collapsed",unload_options:"load_options",show_options:"hide_options"},g=function(b,c,d,f){var g=a(b,f);g.length&&g.each(function(){var f,g,i,j,k;for(f in d)if(i=d[f],g=a(this).closest(i.container||"form").find(f),g.length){switch(j=[],i.type){case"checked":case"unchecked":case"selected":case"unselected":j.push("change","cloneremoved.sabai");break;case"filled":case"empty":j.push("keyup","cloneremoved.sabai");break;case"request":case"requested":j.push("requested.sabai");break;case"values":default:j.push("keyup","change","cloneremoved.sabai")}e[f]={};for(var l=0;l<j.length;l++)k={selector:b,action:c},k.conditions=d,k.container=i.container||"form",g.bind(j[l],k,function(b,c){h(a(this),b.data.selector,b.data.action,b.data.conditions,b.data.container,b.type,c),b.stopPropagation()}),e[f][j[l]]=!0}else SABAI.console.log("Invalid or non existent dependee selector: "+f)})},h=function(a,b,c,d,e,g,h){var l,m,n,j=!0,o=a.closest(e);for(l in d){if(m=o.find(l),!m.length){j=!1;break}if(n=d[l],!i(m,n.type||"value",n.value)){j=!1;break}}c in f&&(c=f[c],j=!j),k(o.find(b),c,j,a,g,h,b)},i=function(b,c,d){switch(c){case"value":case"values":"object"!=typeof d&&(d=[d]);var e=[];b.length>1?b.each(function(){"checkbox"===this.type||"radio"===this.type?this.checked&&e.push(this.value):e.push(a(this).val())}):e.push(b.val());var f=d.length,g=e.length;a:for(var h=0;h<f;h++){for(var i=0;i<g;i++)if("object"!=typeof d[h]){if(d[h]==e[i]){if("value"===c)return!0;continue a}}else if(j(d[h][0],e[i],d[h][1])){if("value"===c)return!0;continue a}if("values"===c)return!1}return"values"===c;case"checked":case"unchecked":var k=!1;return b.each(function(){if(a(this).prop("checked")===Boolean(d))return k=!0,!1}),"checked"===c?k:!k;case"empty":case"filled":case"selected":var k=!1;return b.each(function(){if(""===a.trim(b.val())===Boolean(d))return k=!0,!1}),"empty"===c?k:!k;case"collapsed":case"expanded":var k=!1;return b.each(function(){if((b.hasClass("sabai-form-collapsible")&&b.hasClass("sabai-form-collapsed"))===Boolean(d))return k=!0,!1}),"collapsed"===c?k:!k;case"request":return b.data("request-url")&&b.data("request-result")===d;case"requested":if(b.data("request-url")){var k=b.data("request-result");return("success"===k||"error"===k)===Boolean(d)}return!1;default:return alert("Invalid condition type: "+c),!1}},j=function(a,b,c){switch(c){case"==":return a==b;case"!=":return a!=b;case"<":return a<b;case">":return a>b}},k=function(b,c,f,g,h,i,j){switch(c){case"disabled":b.find(":input").prop("disabled",f);break;case"required":b.toggleClass("sabai-form-field-required",f);break;case"invisible":b.toggleClass("sabai-form-states-invisible",f),f?(b.hide(),i||b.prev(".sabai-form-field").parent().find(".sabai-form-field:visible:last").addClass("sabai-form-field-no-margin")):b.is(":hidden")&&(i?b.show():b.css("opacity",0).slideDown("fast").animate({opacity:1},{queue:!1,duration:"slow"}).prev(".sabai-form-field").removeClass("sabai-form-field-no-margin"));break;case"checked":b.find(":checkbox").prop("checked",f).change();break;case"load_options":if("change"!==h)return;var k=b.find("select");k.find('option[value!=""]').remove();var l=e[j+" select"]&&e[j+" select"].change;if(f){var m=k.data("load-url"),n=m+g.val(),o=SABAI.cache(n),p=function(c){if(SABAI.cache(n,c),void 0!==c&&0===c.length)return b.hide(),k.data("default-value","").val(""),void(l&&k.trigger("change",[i]));if(a.each(c,function(b,c){k.append(a("<option></option>").text(c[1]).val(c[0]))}),!d){var e=k.data("default-value");void 0!==e&&(k.val(e),l&&k.trigger("change",[i]))}if(!b.hasClass("sabai-form-states-invisible")&&b.is(":hidden")&&k.find('option[value!=""]').length){b.removeClass("sabai-hidden").addClass("sabai-was-hidden");var f=b.find(".sabai-form-field-prefix").length?"inline-block":"block";i?b.css("display",f):b.hide().css("display",f).fadeIn("fast")}};!1!==o?p(o):(g.addClass("sabai-ajax-loading"),a.getJSON(m,{value:g.val()},p).always(function(){g.removeClass("sabai-ajax-loading")}))}else!b.is(":hidden")&&b.hasClass("sabai-was-hidden")&&(b.hide(),k.data("default-value","").val(""),l&&k.trigger("change",[i]));break;case"request_url":f?SABAI.ajax({target:b,url:b.data("request-url"),onSuccess:function(a,c,d){b.data("request-result","success").trigger("requested.sabai")},onError:function(a,c,d){b.data("request-result","error").trigger("requested.sabai")},onContent:function(a,c,d){b.data("request-result","error").trigger("requested.sabai")}}):b.data("request-result","");break;case"collapsed":if(!b.hasClass("sabai-form-collapsible"))return;(f&&!b.hasClass("sabai-form-collapsed")||!f&&b.hasClass("sabai-form-collapsed"))&&b.find("a.sabai-form-collapsible:first").click();break;case"hide_options":if(!f||!g.prop("checked"))return;b.find("input").each(function(){var b=a(this),c=b.data("values");b.closest(".sabai-form-field")[c&&-1!==a.inArray(g.val(),c)?"slideDown":"hide"]()});break;default:alert("Invalid action: "+c)}};for(l in b){m=b[l];for(action in m)g(l,action,m[action].conditions,c)}for(n in e)for(o in e[n])a(n,c).trigger(o,[!0])},SABAI.cloneField=function(b,c,d,e,f){var g=a(b),h=g.find("> .sabai-form-field:not(.sabai-form-field-add)"),i=e||h.length;if(!(d&&i>=d)){var j=h.first(),k=j.clone().attr("id","sabai-"+SABAI.guid()).find(":input").each(function(){var b=jQuery(this);b.attr("name")&&(field_name=f.data("field-form-wrap")?f.data("field-form-wrap")+"["+c+"]":c,b.attr("name",b.attr("name").replace(field_name+"[0]",field_name+"["+i+"]"))),b.attr("id")&&b.attr("id",b.attr("id")+"-"+i),b.removeData("default-value").removeAttr("data-default-value"),a.fn.uniform&&b.parent().is(".selector")&&b.prev("span").remove().end().unwrap().uniform().parent(".selector").show()}).end().clearInput().removeClass("sabai-form-field-error").find("span.sabai-form-field-error").remove().end().find(".sabai-was-hidden").hide().end().hide().insertAfter(h.last());k.append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').slideDown("fast").focusFirstInput().find("a.sabai-form-field-remove").click(function(b){a(this).closest(".sabai-form-field").fadeTo("fast",0,function(){a(this).slideUp("fast",function(){a(this).remove();var b=g.find("> .sabai-form-field:not(.sabai-form-field-add)");d&&b.length<d&&f.show(),b.find(":input").trigger("cloneremoved.sabai")})}),b.preventDefault()}).parent().css("position","relative"),a(SABAI).trigger("clonefield.sabai",{container:b,field:j,clone:k,index:i}),d&&f&&i+1>=d&&f.hide()}},SABAI.addOption=function(b,c,d,e,f){var g=a(b),h=a(d).closest(".sabai-form-field-option"),i=g.find("> .sabai-form-field-option"),j=e?c+"[default][]":c+"[default]",k=h.find("input[name='"+j+"']").val(),l=h.clone().find(":text").each(function(){var a=jQuery(this);a.attr("name")&&a.attr("name",a.attr("name").replace(c+"[options]["+k+"]",c+"[options]["+i.length+"]"))}).end().clearInput().find("input[name='"+j+"']").val(i.length).end().hide().insertAfter(h);return f&&f.call(null,l),l.slideDown("fast").focusFirstInput(),!1},SABAI.removeOption=function(b,c,d){var e=a(b).find("> .sabai-form-field-option:not(.sabai-form-field-option-disabled)");return 1===e.length?void e.clearInput():!!confirm(d)&&void a(c).closest(".sabai-form-field-option").slideUp("fast",function(){a(this).remove()})},SABAI.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)})},window.history&&window.history.pushState){var b=!1,c=window.location.href.replace(/%2F/g,"/");a(window).on("popstate",function(d){if(b||(b=!0,location.href.replace(/%2F/g,"/")!=c)){var e=d.originalEvent.state;e?(e.data.__ajax=e.target?e.container+" "+e.target:e.container,SABAI.ajax(e),a(SABAI).trigger("sabaipopstate.sabai",e)):window.location.href=window.location.href}})}SABAI.parseUrl=function(b){var c=b?a("<a/>").prop("href",b)[0]:window.location;if(c.query={},c.search&&"string"==typeof c.search){var d=c.search.substr(1).replace(/\+/g,"%20").split("&");a.each(d,function(a,b){var d=b.split("=");try{d[1]=decodeURIComponent(d[1])}catch(a){}c.query[d[0]]=d[1]})}return c},SABAI.getScript=function(b,c,d){return c=a.extend(c||{},{dataType:"script",cache:!0,url:b}),jQuery.ajax(c,d)},a.fn.sabai=function(){SABAI.init(this)},a.fn.focusTextRange=function(a,b){if(this.is('input[type="text"]')||this.is("textarea")){var c=this.get(0);if(c.setSelectionRange)c.focus(),c.setSelectionRange(a,b);else if(c.createTextRange){var d=c.createTextRange();d.collapse(!0),d.moveEnd("character",b),d.moveStart("character",a),d.select()}}return this},a.fn.focusFirstInput=function(){var a=this.find('input[type="text"],input[type="password"],textarea').not(".sabai-focus-off").filter(":visible:first");if(!a.length)return this;var b=a.val().length;return a.focusTextRange(b,b),this},a.fn.clearInput=function(){return this.each(function(){var b=a(this),c=b.get(0).tagName.toLowerCase();if(void 0!==b.data("default-value"))return void b.val(b.data("default-value"));if("input"===c){var d=b.attr("type");"checkbox"===d||"radio"===d?b.prop("checked",!1):b.val("")}else if("textarea"===c)b.val("");else{if("select"!==c)return b.find(":input").clearInput();b.prop("selectedIndex",0)}})}}(jQuery);